#!/bin/bash
# Pre-push hook for Intelluxe AI Healthcare System
# Runs comprehensive validation before pushing to prevent CI failures

set -e

echo "ğŸ” Pre-push validation for Intelluxe AI Healthcare System..."
echo "============================================================="

# Check if we're in the right directory
if [ ! -f "Makefile" ] || [ ! -f "scripts/bootstrap.sh" ]; then
    echo "âŒ Error: Must be run from Intelluxe repository root"
    exit 1
fi

# Set environment variables for CI-like behavior
export CI=true
export ENVIRONMENT=development

echo ""
echo "ğŸ“ Step 1/3: Running linters (shellcheck, flake8, mypy)..."
if ! make lint; then
    echo "âŒ Linting failed! Fix issues before pushing."
    echo "ğŸ’¡ Run 'make lint' to see details"
    exit 1
fi

echo ""
echo "âœ… Step 2/3: Validating configuration and dependencies..."
if ! make validate; then
    echo "âŒ Validation failed! Fix configuration issues before pushing."
    echo "ğŸ’¡ Run 'make validate' to see details"
    exit 1
fi

echo ""
echo "ğŸ§ª Step 3/3: Running test suite..."
if ! make test-quiet; then
    echo "âŒ Tests failed! Fix failing tests before pushing."
    echo "ğŸ’¡ Run 'make test' for detailed output"
    exit 1
fi

echo ""
echo "âœ… All pre-push checks passed! Push proceeding..."
echo "ğŸš€ Your code is ready for CI validation."
