#!/bin/bash
# Pre-push hook for Intelluxe AI Healthcare System
# Runs comprehensive validation before pushing to prevent CI failures

set -e

echo "🔍 Pre-push validation for Intelluxe AI Healthcare System..."
echo "============================================================="

# Check if we're in the right directory
if [ ! -f "Makefile" ] || [ ! -f "scripts/bootstrap.sh" ]; then
    echo "❌ Error: Must be run from Intelluxe repository root"
    exit 1
fi

# Set environment variables for CI-like behavior
export CI=true
export ENVIRONMENT=development

echo ""
echo "📝 Step 1/3: Running linters (shellcheck, flake8, mypy)..."
if ! make lint; then
    echo "❌ Linting failed! Fix issues before pushing."
    echo "💡 Run 'make lint' to see details"
    exit 1
fi

echo ""
echo "✅ Step 2/3: Validating configuration and dependencies..."
if ! make validate; then
    echo "❌ Validation failed! Fix configuration issues before pushing."
    echo "💡 Run 'make validate' to see details"
    exit 1
fi

echo ""
echo "🧪 Step 3/3: Running test suite..."
if ! make test-quiet; then
    echo "❌ Tests failed! Fix failing tests before pushing."
    echo "💡 Run 'make test' for detailed output"
    exit 1
fi

echo ""
echo "✅ All pre-push checks passed! Push proceeding..."
echo "🚀 Your code is ready for CI validation."
