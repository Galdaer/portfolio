#!/bin/bash
# Pre-push hook for Intelluxe AI Healthcare System
# Runs comprehensive validation before pushing to prevent CI failures

echo "ğŸ” Pre-push validation for Intelluxe AI Healthcare System..."
echo "============================================================="

# Check if we're in the right directory
if [ ! -f "Makefile" ] || [ ! -f "scripts/bootstrap.sh" ]; then
    echo "âŒ Error: Must be run from Intelluxe repository root"
    exit 1
fi

# Set environment variables for CI-like behavior
export CI=true
export ENVIRONMENT=development

echo ""
echo "ğŸ“ Step 1/3: Running linters (shellcheck, flake8, mypy)..."
if ! make lint; then
    echo ""
    echo "âŒ Linting failed! Fix the issues shown above before pushing."
    echo "ğŸ’¡ Run 'make lint' locally to see the same errors"
    echo "ğŸ’¡ Common fixes:"
    echo "   - Install missing type stubs: pip install types-PyYAML types-requests"
    echo "   - Fix shellcheck warnings in shell scripts"
    echo "   - Fix flake8/mypy errors in Python files"
    exit 1
fi

echo ""
echo "âœ… Step 2/3: Validating configuration and dependencies..."
if ! make validate; then
    echo ""
    echo "âŒ Validation failed! Fix the configuration issues shown above."
    echo "ğŸ’¡ Run 'make validate' locally to see the same errors"
    exit 1
fi

echo ""
echo "ğŸ§ª Step 3/3: Running test suite..."
if ! make test; then
    echo ""
    echo "âŒ Tests failed! Fix the failing tests shown above."
    echo "ğŸ’¡ Run 'make test' locally for detailed test output"
    exit 1
fi

echo ""
echo "âœ… All pre-push checks passed! Push proceeding..."
echo "ğŸš€ Your code is ready for CI validation."
